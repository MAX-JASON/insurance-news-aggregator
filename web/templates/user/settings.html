{% extends "layout.html" %}
{% block title %}個人偏好設置 - 保險新聞聚合平台{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row">
        <div class="col-lg-3">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-cog me-2"></i>設置菜單</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush" id="settings-tabs" role="tablist">
                        <a class="list-group-item list-group-item-action active" id="appearance-tab" data-bs-toggle="list" href="#appearance" role="tab" aria-controls="appearance" aria-selected="true">
                            <i class="fas fa-palette me-2"></i>外觀與界面
                        </a>
                        <a class="list-group-item list-group-item-action" id="notifications-tab" data-bs-toggle="list" href="#notifications" role="tab" aria-controls="notifications" aria-selected="false">
                            <i class="fas fa-bell me-2"></i>通知偏好
                        </a>
                        <a class="list-group-item list-group-item-action" id="dashboard-tab" data-bs-toggle="list" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false">
                            <i class="fas fa-tachometer-alt me-2"></i>儀表板設置
                        </a>
                        <a class="list-group-item list-group-item-action" id="news-tab" data-bs-toggle="list" href="#news" role="tab" aria-controls="news" aria-selected="false">
                            <i class="fas fa-newspaper me-2"></i>新聞偏好
                        </a>
                        <a class="list-group-item list-group-item-action" id="data-tab" data-bs-toggle="list" href="#data" role="tab" aria-controls="data" aria-selected="false">
                            <i class="fas fa-database me-2"></i>數據與隱私
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="card shadow-sm mt-4">
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button id="save-user-settings" class="btn btn-success">
                            <i class="fas fa-save me-2"></i>保存設置
                        </button>
                        <button id="reset-user-settings" class="btn btn-outline-secondary">
                            <i class="fas fa-undo me-2"></i>重置為預設值
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-9">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fas fa-user-cog me-2"></i>個人偏好設置</h4>
                </div>
                <div class="card-body">
                    <div class="tab-content">
                        <!-- 外觀與界面 -->
                        <div class="tab-pane fade show active" id="appearance" role="tabpanel" aria-labelledby="appearance-tab" tabindex="0">
                            <h5 class="border-bottom pb-2 mb-3">主題選擇</h5>
                            <div class="mb-4">
                                <div class="row">
                                    <div class="col-6 col-md-3 mb-3">
                                        <div class="theme-option card h-100 cursor-pointer" data-theme="light">
                                            <div class="card-body p-2 bg-light">
                                                <div class="theme-preview d-flex flex-column border rounded p-2 mb-2" style="height: 80px;">
                                                    <div class="bg-primary" style="height: 20px;"></div>
                                                    <div class="bg-white flex-grow-1"></div>
                                                </div>
                                                <div class="text-center">淺色主題</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3 mb-3">
                                        <div class="theme-option card h-100 cursor-pointer" data-theme="dark">
                                            <div class="card-body p-2 bg-light">
                                                <div class="theme-preview d-flex flex-column border rounded p-2 mb-2" style="height: 80px;">
                                                    <div class="bg-dark" style="height: 20px;"></div>
                                                    <div class="bg-secondary flex-grow-1"></div>
                                                </div>
                                                <div class="text-center">深色主題</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3 mb-3">
                                        <div class="theme-option card h-100 cursor-pointer" data-theme="blue">
                                            <div class="card-body p-2 bg-light">
                                                <div class="theme-preview d-flex flex-column border rounded p-2 mb-2" style="height: 80px;">
                                                    <div class="bg-primary" style="height: 20px;"></div>
                                                    <div class="bg-info bg-opacity-25 flex-grow-1"></div>
                                                </div>
                                                <div class="text-center">藍色主題</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3 mb-3">
                                        <div class="theme-option card h-100 cursor-pointer" data-theme="professional">
                                            <div class="card-body p-2 bg-light">
                                                <div class="theme-preview d-flex flex-column border rounded p-2 mb-2" style="height: 80px;">
                                                    <div style="height: 20px; background-color: #2c3e50;"></div>
                                                    <div style="background-color: #ecf0f1;" class="flex-grow-1"></div>
                                                </div>
                                                <div class="text-center">專業主題</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h5 class="border-bottom pb-2 mb-3">字體大小</h5>
                            <div class="mb-4">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <input type="range" class="form-range" id="font-size-slider" min="12" max="24" step="1">
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-text-height"></i></span>
                                            <input type="text" class="form-control" id="font-size-value" disabled>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h5 class="border-bottom pb-2 mb-3">顯示選項</h5>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="compact-view-toggle">
                                <label class="form-check-label" for="compact-view-toggle">使用緊湊視圖（減少間距，顯示更多內容）</label>
                            </div>
                            
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="animations-toggle" checked>
                                <label class="form-check-label" for="animations-toggle">啟用頁面動畫效果</label>
                            </div>
                            
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="high-contrast-toggle">
                                <label class="form-check-label" for="high-contrast-toggle">高對比度模式</label>
                            </div>
                        </div>
                        
                        <!-- 通知偏好 -->
                        <div class="tab-pane fade" id="notifications" role="tabpanel" aria-labelledby="notifications-tab" tabindex="0">
                            <h5 class="border-bottom pb-2 mb-3">通知設置</h5>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="notifications-toggle" checked>
                                <label class="form-check-label" for="notifications-toggle">啟用系統通知</label>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i> 通知將在右下角以彈窗方式顯示，您可以根據自己的喜好設置通知類型。
                            </div>
                            
                            <h5 class="border-bottom pb-2 mb-3 mt-4">通知類型</h5>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="notification-news" checked>
                                <label class="form-check-label" for="notification-news">重要新聞發布通知</label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="notification-system" checked>
                                <label class="form-check-label" for="notification-system">系統更新通知</label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="notification-activity" checked>
                                <label class="form-check-label" for="notification-activity">帳號活動通知</label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="notification-marketing">
                                <label class="form-check-label" for="notification-marketing">市場營銷資訊</label>
                            </div>
                        </div>
                        
                        <!-- 儀表板設置 -->
                        <div class="tab-pane fade" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab" tabindex="0">
                            <h5 class="border-bottom pb-2 mb-3">布局選擇</h5>
                            <div class="mb-4">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="dashboard-layout" id="layout-grid" value="grid" checked>
                                    <label class="form-check-label" for="layout-grid">
                                        網格布局（卡片式）
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="dashboard-layout" id="layout-list" value="list">
                                    <label class="form-check-label" for="layout-list">
                                        列表布局（詳細資訊）
                                    </label>
                                </div>
                            </div>
                            
                            <h5 class="border-bottom pb-2 mb-3">自動刷新</h5>
                            <div class="mb-4">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="auto-refresh-toggle">
                                    <label class="form-check-label" for="auto-refresh-toggle">啟用自動刷新</label>
                                </div>
                                
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <label for="refresh-interval" class="form-label">刷新間隔（分鐘）</label>
                                        <input type="range" class="form-range" id="refresh-interval" min="1" max="30" step="1" value="5">
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-clock"></i></span>
                                            <input type="text" class="form-control" id="refresh-interval-value" disabled value="5 分鐘">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h5 class="border-bottom pb-2 mb-3">小工具顯示</h5>
                            <div class="mb-4">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="widget-news" checked>
                                    <label class="form-check-label" for="widget-news">
                                        最新新聞小工具
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="widget-stats" checked>
                                    <label class="form-check-label" for="widget-stats">
                                        統計數據小工具
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="widget-calendar" checked>
                                    <label class="form-check-label" for="widget-calendar">
                                        日曆與提醒小工具
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="widget-notifications" checked>
                                    <label class="form-check-label" for="widget-notifications">
                                        通知中心小工具
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 新聞偏好 -->
                        <div class="tab-pane fade" id="news" role="tabpanel" aria-labelledby="news-tab" tabindex="0">
                            <h5 class="border-bottom pb-2 mb-3">內容偏好</h5>
                            <div class="mb-4">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="content-breaking" checked>
                                    <label class="form-check-label" for="content-breaking">
                                        重大突發新聞
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="content-policy" checked>
                                    <label class="form-check-label" for="content-policy">
                                        政策法規變動
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="content-market" checked>
                                    <label class="form-check-label" for="content-market">
                                        市場動態分析
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="content-product" checked>
                                    <label class="form-check-label" for="content-product">
                                        保險產品資訊
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="content-company" checked>
                                    <label class="form-check-label" for="content-company">
                                        公司動態報導
                                    </label>
                                </div>
                            </div>
                            
                            <h5 class="border-bottom pb-2 mb-3">列表顯示設置</h5>
                            <div class="mb-4">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="show-thumbnail" checked>
                                    <label class="form-check-label" for="show-thumbnail">顯示新聞縮略圖</label>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="show-summary" checked>
                                    <label class="form-check-label" for="show-summary">顯示新聞摘要</label>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="highlight-keywords" checked>
                                    <label class="form-check-label" for="highlight-keywords">高亮顯示關鍵字</label>
                                </div>
                            </div>
                            
                            <h5 class="border-bottom pb-2 mb-3">排序方式</h5>
                            <div class="mb-4">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="sort-news" id="sort-latest" value="latest" checked>
                                    <label class="form-check-label" for="sort-latest">
                                        最新發布優先
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="sort-news" id="sort-relevance" value="relevance">
                                    <label class="form-check-label" for="sort-relevance">
                                        相關度優先
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="sort-news" id="sort-importance" value="importance">
                                    <label class="form-check-label" for="sort-importance">
                                        重要性優先
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 數據與隱私 -->
                        <div class="tab-pane fade" id="data" role="tabpanel" aria-labelledby="data-tab" tabindex="0">
                            <h5 class="border-bottom pb-2 mb-3">數據存儲</h5>
                            <div class="mb-4">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i> 您的設置和偏好數據存儲在瀏覽器的本地存儲中，不會發送到服務器或第三方。
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="save-search-history" checked>
                                    <label class="form-check-label" for="save-search-history">保存搜索歷史</label>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="save-read-history" checked>
                                    <label class="form-check-label" for="save-read-history">保存閱讀歷史</label>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="allow-analytics">
                                    <label class="form-check-label" for="allow-analytics">允許匿名使用數據分析</label>
                                </div>
                                
                                <button id="clear-local-data" class="btn btn-warning mt-3">
                                    <i class="fas fa-trash-alt me-2"></i>清除所有本地存儲數據
                                </button>
                            </div>
                            
                            <h5 class="border-bottom pb-2 mb-3">數據備份</h5>
                            <div class="mb-4">
                                <p>您可以備份您的設置和偏好數據，以便在其他設備上恢復。</p>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <button id="export-settings" class="btn btn-primary w-100 mb-2">
                                            <i class="fas fa-download me-2"></i>導出設置數據
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <button id="import-settings" class="btn btn-secondary w-100 mb-2">
                                            <i class="fas fa-upload me-2"></i>導入設置數據
                                        </button>
                                    </div>
                                </div>
                                
                                <input type="file" id="settings-file-input" class="d-none">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/user-settings.js') }}"></script>
<script src="{{ url_for('static', filename='js/global-error-handler.js') }}"></script>

<script>
$(document).ready(function() {
    // 主題選擇卡片點擊效果
    $('.theme-option').on('click', function() {
        $('.theme-option').removeClass('border-primary');
        $(this).addClass('border-primary');
    });
    
    // 刷新間隔滑塊顯示值
    $('#refresh-interval').on('input', function() {
        $('#refresh-interval-value').val($(this).val() + ' 分鐘');
    });
    
    // 添加導出設置功能
    $('#export-settings').on('click', function() {
        try {
            const settings = localStorage.getItem('userSettings');
            if (settings) {
                const blob = new Blob([settings], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'insurance-news-user-settings.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                if (window.businessTools && window.businessTools.showToast) {
                    window.businessTools.showToast('設置數據已成功導出', 'success');
                }
            } else {
                if (window.businessTools && window.businessTools.showToast) {
                    window.businessTools.showToast('沒有找到設置數據', 'warning');
                }
            }
        } catch (error) {
            console.error('導出設置時出錯:', error);
            if (window.businessTools && window.businessTools.showToast) {
                window.businessTools.showToast('導出設置時出錯', 'error');
            }
        }
    });
    
    // 添加導入設置功能
    $('#import-settings').on('click', function() {
        $('#settings-file-input').click();
    });
    
    $('#settings-file-input').on('change', function(e) {
        try {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const settings = event.target.result;
                        JSON.parse(settings); // 驗證是否為有效的JSON
                        
                        localStorage.setItem('userSettings', settings);
                        
                        // 重新載入設置
                        initUserSettings();
                        
                        if (window.businessTools && window.businessTools.showToast) {
                            window.businessTools.showToast('設置數據已成功導入並應用', 'success');
                        }
                    } catch (error) {
                        console.error('解析導入設置時出錯:', error);
                        if (window.businessTools && window.businessTools.showToast) {
                            window.businessTools.showToast('導入的文件不是有效的設置數據', 'error');
                        }
                    }
                };
                reader.readAsText(file);
            }
        } catch (error) {
            console.error('導入設置時出錯:', error);
            if (window.businessTools && window.businessTools.showToast) {
                window.businessTools.showToast('導入設置時出錯', 'error');
            }
        }
    });
    
    // 添加清除本地數據功能
    $('#clear-local-data').on('click', function() {
        try {
            if (confirm('確定要清除所有本地存儲的數據嗎？此操作無法恢復。')) {
                localStorage.clear();
                
                // 重新載入頁面來應用默認設置
                location.reload();
            }
        } catch (error) {
            console.error('清除本地數據時出錯:', error);
            if (window.businessTools && window.businessTools.showToast) {
                window.businessTools.showToast('清除本地數據時出錯', 'error');
            }
        }
    });
});
</script>
{% endblock %}
