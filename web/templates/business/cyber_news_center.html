{% extends "business/base.html" %}

{% block title %}æ¥­å‹™å“¡æ–°èä¸­å¿ƒ - è³½åšæœ‹å…‹é¢¨æ ¼{% endblock %}

{% block extra_css %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cyber_crawler.css') }}">
<style>
/* æ¥­å‹™å“¡å°ˆç”¨å¸ƒå±€ */
.business-layout {
    display: grid;
    grid-template-columns: 300px 1fr 250px;
    grid-template-rows: auto 1fr;
    grid-template-areas: 
        "header header header"
        "sidebar main aside";
    height: 100vh;
    gap: 1px;
}

.cyber-header {
    grid-area: header;
    background: rgba(0, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border-bottom: 1px solid rgba(0, 255, 255, 0.3);
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.cyber-main {
    grid-area: main;
    padding: var(--spacing-md);
    overflow-y: auto;
    background: var(--bg-primary);
}

.cyber-aside {
    grid-area: aside;
    background: var(--bg-secondary);
    backdrop-filter: blur(15px);
    border-left: 1px solid rgba(0, 212, 255, 0.3);
    padding: var(--spacing-md);
    overflow-y: auto;
}

/* å®¢æˆ¶åˆ—è¡¨ */
.client-list {
    margin-bottom: var(--spacing-lg);
}

.client-item {
    background: rgba(0, 212, 255, 0.1);
    border: 1px solid rgba(0, 212, 255, 0.3);
    border-radius: 8px;
    padding: var(--spacing-sm);
    margin-bottom: var(--spacing-xs);
    cursor: pointer;
    transition: all var(--transition-normal) ease;
    position: relative;
}

.client-item:hover {
    background: rgba(0, 212, 255, 0.2);
    box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
}

.client-item.active {
    border-color: var(--neon-green);
    background: rgba(57, 255, 20, 0.1);
}

.client-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--neon-purple), var(--neon-blue));
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    margin-right: var(--spacing-sm);
}

/* æ–°èå„ªå…ˆç´šæŒ‡ç¤ºå™¨ */
.priority-indicator {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid var(--bg-primary);
}

.priority-critical {
    background: var(--neon-pink);
    animation: criticalPulse 1s ease-in-out infinite;
}

.priority-high {
    background: var(--neon-orange);
}

.priority-medium {
    background: var(--neon-blue);
}

.priority-low {
    background: var(--neon-green);
}

@keyframes criticalPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
}

/* æ¥­å‹™æ©Ÿæœƒæé†’ */
.opportunity-alert {
    background: linear-gradient(45deg, var(--neon-pink), var(--neon-orange));
    border: none;
    color: white;
    padding: var(--spacing-sm);
    border-radius: 8px;
    margin-bottom: var(--spacing-md);
    animation: opportunityGlow 2s ease-in-out infinite;
}

@keyframes opportunityGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 7, 58, 0.3); }
    50% { box-shadow: 0 0 40px rgba(255, 7, 58, 0.6); }
}

/* å¿«é€Ÿæ“ä½œé¢æ¿ */
.quick-actions {
    display: flex;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
}

.action-button {
    flex: 1;
    background: transparent;
    border: 1px solid var(--neon-blue);
    color: var(--neon-blue);
    padding: var(--spacing-sm);
    border-radius: 6px;
    cursor: pointer;
    transition: all var(--transition-normal) ease;
    text-align: center;
    font-size: 0.9rem;
}

.action-button:hover {
    background: rgba(0, 212, 255, 0.1);
    box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
}

/* æ‹–æ‹½æ•ˆæœ */
.news-card.dragging {
    opacity: 0.5;
    transform: rotate(5deg);
    z-index: 1000;
}

.drop-zone {
    border: 2px dashed var(--neon-green);
    background: rgba(57, 255, 20, 0.1);
    border-radius: 8px;
    padding: var(--spacing-md);
    text-align: center;
    color: var(--neon-green);
    margin-bottom: var(--spacing-md);
    opacity: 0;
    transition: opacity var(--transition-normal) ease;
}

.drop-zone.active {
    opacity: 1;
}

/* çµ±è¨ˆå„€è¡¨æ¿ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.stat-card {
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: var(--spacing-md);
    text-align: center;
    position: relative;
    overflow: hidden;
}

.stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: var(--neon-cyan);
    text-shadow: 0 0 10px currentColor;
}

.stat-label {
    color: var(--text-secondary);
    margin-top: var(--spacing-xs);
}

.stat-trend {
    position: absolute;
    top: var(--spacing-sm);
    right: var(--spacing-sm);
    font-size: 0.8rem;
}

.trend-up {
    color: var(--neon-green);
}

.trend-down {
    color: var(--neon-pink);
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 1200px) {
    .business-layout {
        grid-template-columns: 250px 1fr;
        grid-template-areas: 
            "header header"
            "sidebar main";
    }
    
    .cyber-aside {
        display: none;
    }
}

@media (max-width: 768px) {
    .business-layout {
        grid-template-columns: 1fr;
        grid-template-areas: 
            "header"
            "main";
    }
    
    .cyber-sidebar {
        display: none;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}

{% block business_content %}
<div class="business-layout">
    <!-- é é¢æ¨™é¡Œ -->
    <div class="cyber-header">
        <div class="d-flex align-items-center">
            <h1 class="nav-brand" data-typing>æ¥­å‹™å“¡æ–°èä¸­å¿ƒ</h1>
            <span class="badge bg-primary ms-3">CYBER MODE</span>
        </div>
        
        <div class="d-flex align-items-center gap-3">
            <div class="search-container">
                <input type="text" class="form-control bg-transparent text-light border-info" 
                       placeholder="æ™ºèƒ½æœç´¢..." id="globalSearch">
            </div>
            <button class="neon-btn purple" onclick="toggleFullscreen()">
                <i class="fas fa-expand"></i>
            </button>
            <button class="neon-btn green" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>
    
    <!-- å·¦å´é‚Šæ¬„ - å®¢æˆ¶ç®¡ç† -->
    <div class="cyber-sidebar">
        <h3 class="text-cyan mb-3">
            <i class="fas fa-users me-2"></i>å®¢æˆ¶åˆ—è¡¨
        </h3>
        
        <!-- å®¢æˆ¶çµ±è¨ˆ -->
        <div class="glass-card mb-3">
            <div class="d-flex justify-content-between">
                <span>æ´»èºå®¢æˆ¶</span>
                <span class="text-success">24</span>
            </div>
            <div class="d-flex justify-content-between">
                <span>å¾…è·Ÿé€²</span>
                <span class="text-warning">8</span>
            </div>
            <div class="d-flex justify-content-between">
                <span>æœ¬é€±æ–°å¢</span>
                <span class="text-info">3</span>
            </div>
        </div>
        
        <!-- å®¢æˆ¶åˆ—è¡¨ -->
        <div class="client-list">
            <div class="client-item active" data-client-id="1">
                <div class="client-avatar">å¼µ</div>
                <span>å¼µç¾ç²</span>
                <div class="priority-indicator priority-high"></div>
            </div>
            <div class="client-item" data-client-id="2">
                <div class="client-avatar">æ</div>
                <span>æå¿—æ˜</span>
                <div class="priority-indicator priority-medium"></div>
            </div>
            <div class="client-item" data-client-id="3">
                <div class="client-avatar">ç‹</div>
                <span>ç‹å°è¯</span>
                <div class="priority-indicator priority-critical"></div>
            </div>
        </div>
        
        <!-- å¿«é€Ÿç¯©é¸ -->
        <h4 class="text-cyan mb-2">å¿«é€Ÿç¯©é¸</h4>
        <div class="d-grid gap-2">
            <button class="action-button" data-filter="today">ä»Šæ—¥æ–°è</button>
            <button class="action-button" data-filter="important">é‡è¦æ–°è</button>
            <button class="action-button" data-filter="opportunity">å•†æ©Ÿæ–°è</button>
            <button class="action-button" data-filter="saved">å·²æ”¶è—</button>
        </div>
    </div>
    
    <!-- ä¸»è¦å…§å®¹å€ -->
    <div class="cyber-main">
        <!-- æ¥­å‹™æ©Ÿæœƒæé†’ -->
        <div class="opportunity-alert" id="opportunityAlert" style="display: none;">
            <h5><i class="fas fa-exclamation-triangle me-2"></i>æ¥­å‹™æ©Ÿæœƒæé†’</h5>
            <p id="opportunityText"></p>
        </div>
        
        <!-- çµ±è¨ˆé¢æ¿ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">156</div>
                <div class="stat-label">ä»Šæ—¥æ–°è</div>
                <div class="stat-trend trend-up">+12%</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">23</div>
                <div class="stat-label">é‡è¦æ–°è</div>
                <div class="stat-trend trend-up">+8%</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">7</div>
                <div class="stat-label">æ¥­å‹™æ©Ÿæœƒ</div>
                <div class="stat-trend trend-down">-2</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">45</div>
                <div class="stat-label">å·²åˆ†äº«</div>
                <div class="stat-trend trend-up">+15%</div>
            </div>
        </div>
        
        <!-- å¿«é€Ÿæ“ä½œ -->
        <div class="quick-actions">
            <button class="action-button" onclick="selectAll()">å…¨é¸</button>
            <button class="action-button" onclick="shareSelected()">æ‰¹é‡åˆ†äº«</button>
            <button class="action-button" onclick="markImportant()">æ¨™è¨˜é‡è¦</button>
            <button class="action-button" onclick="exportPDF()">åŒ¯å‡ºPDF</button>
        </div>
        
        <!-- æ‹–æ‹½å€åŸŸ -->
        <div class="drop-zone" id="shareDropZone">
            <i class="fas fa-share-alt fa-2x mb-2"></i>
            <div>æ‹–æ‹½æ–°èåˆ°æ­¤è™•å¿«é€Ÿåˆ†äº«</div>
        </div>
        
        <!-- æ–°èåˆ—è¡¨ -->
        <div id="newsList">
            <!-- æ–°èé …ç›®æœƒé€šéJavaScriptå‹•æ…‹è¼‰å…¥ -->
        </div>
        
        <!-- è¼‰å…¥æ›´å¤š -->
        <div class="text-center mt-4">
            <button class="neon-btn" id="loadMoreBtn">è¼‰å…¥æ›´å¤š</button>
        </div>
    </div>
    
    <!-- å³å´é‚Šæ¬„ - å¿«é€Ÿå·¥å…· -->
    <div class="cyber-aside">
        <h4 class="text-cyan mb-3">
            <i class="fas fa-tools me-2"></i>å¿«é€Ÿå·¥å…·
        </h4>
        
        <!-- æ–°èé è¦½ -->
        <div class="glass-card mb-3" id="newsPreview" style="display: none;">
            <h5 class="text-info">æ–°èé è¦½</h5>
            <div id="previewContent"></div>
            <div class="mt-2">
                <button class="neon-btn btn-sm green" onclick="sharePreview()">åˆ†äº«</button>
                <button class="neon-btn btn-sm purple" onclick="savePreview()">æ”¶è—</button>
            </div>
        </div>
        
        <!-- AIåŠ©æ‰‹ -->
        <div class="glass-card mb-3">
            <h5 class="text-purple">
                <i class="fas fa-robot me-2"></i>AIåŠ©æ‰‹
            </h5>
            <div class="mb-2">
                <small class="text-secondary">æ™ºèƒ½åˆ†æå»ºè­°</small>
            </div>
            <div id="aiSuggestions">
                <div class="alert alert-info">
                    <small>åŸºæ–¼å®¢æˆ¶å¼µç¾ç²çš„æŠ•ä¿è¨˜éŒ„ï¼Œå»ºè­°é—œæ³¨é†«ç™‚éšªç›¸é—œæ–°è</small>
                </div>
            </div>
        </div>
        
        <!-- ä»Šæ—¥ä»»å‹™ -->
        <div class="glass-card">
            <h5 class="text-orange">
                <i class="fas fa-tasks me-2"></i>ä»Šæ—¥ä»»å‹™
            </h5>
            <div class="task-list">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span>è·Ÿé€²ç‹å°è¯</span>
                    <input type="checkbox" class="form-check-input">
                </div>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span>æº–å‚™ææ¡ˆæ›¸</span>
                    <input type="checkbox" class="form-check-input" checked>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span>å®¢æˆ¶å›è¨ª</span>
                    <input type="checkbox" class="form-check-input">
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/cyberpunk-effects.js') }}"></script>
<script src="{{ url_for('static', filename='js/cyber_crawler.js') }}"></script>
<script>
// æ¥­å‹™å“¡æ–°èä¸­å¿ƒç®¡ç†å™¨
class BusinessNewsCenter {
    constructor() {
        this.selectedNews = new Set();
        this.currentClient = null;
        this.newsData = [];
        this.init();
    }
    
    init() {
        this.loadNews();
        this.bindEvents();
        this.startRealTimeUpdates();
    }
    
    async loadNews() {
        try {
            // æ¨¡æ“¬APIèª¿ç”¨
            const response = await fetch('/business/api/cyber-news');
            if (response.ok) {
                this.newsData = await response.json();
            } else {
                // ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
                this.newsData = this.generateMockNews();
            }
            this.renderNews();
        } catch (error) {
            console.error('è¼‰å…¥æ–°èå¤±æ•—:', error);
            this.newsData = { news: this.generateMockNews() };
            this.renderNews();
        }
    }
    
    generateMockNews() {
        const mockNews = [];
        const titles = [
            'é‡‘ç®¡æœƒç™¼å¸ƒæ–°ç‰ˆä¿éšªå•†å“ç®¡ç†è¾¦æ³•',
            'æ•¸ä½ä¿éšªå¹³å°ä½¿ç”¨ç‡å‰µæ–°é«˜',
            'é†«ç™‚éšªç†è³ çˆ­è­°æ¡ˆä¾‹åˆ†æ',
            'é€€ä¼‘è¦åŠƒï¼šå¹´é‡‘ä¿éšªè¶¨å‹¢è§€å¯Ÿ',
            'ä¿éšªç§‘æŠ€FinTechæœ€æ–°ç™¼å±•'
        ];
        
        for (let i = 0; i < 20; i++) {
            mockNews.push({
                id: i + 1,
                title: titles[i % titles.length] + ` ${i + 1}`,
                summary: 'é€™æ˜¯ä¸€æ¢é‡è¦çš„ä¿éšªæ¥­æ–°èæ‘˜è¦ï¼Œå°æ¥­å‹™å“¡å’Œå®¢æˆ¶éƒ½æœ‰é‡è¦åƒè€ƒåƒ¹å€¼...',
                priority: ['low', 'medium', 'high', 'critical'][Math.floor(Math.random() * 4)],
                timestamp: new Date(Date.now() - Math.random() * 86400000),
                source: 'å·¥å•†æ™‚å ±',
                tags: ['é†«ç™‚éšª', 'æ•¸ä½ä¿éšª', 'æ³•è¦'],
                business_impact: Math.random() > 0.5 ? 'é«˜' : 'ä¸­',
                relevant_clients: ['å¼µç¾ç²', 'æå¿—æ˜'].slice(0, Math.floor(Math.random() * 2) + 1)
            });
        }
        return mockNews;
    }
    
    renderNews() {
        const newsList = document.getElementById('newsList');
        newsList.innerHTML = '';
        
        const newsArray = this.newsData.news || this.newsData;
        newsArray.forEach(news => {
            const newsCard = this.createNewsCard(news);
            newsList.appendChild(newsCard);
        });
    }
    
    createNewsCard(news) {
        const card = document.createElement('div');
        card.className = `news-card news-priority-${news.priority} fade-in`;
        card.draggable = true;
        card.dataset.newsId = news.id;
        
        card.innerHTML = `
            <div class="d-flex align-items-start gap-3">
                <input type="checkbox" class="form-check-input news-checkbox" 
                       data-news-id="${news.id}">
                <div class="flex-grow-1">
                    <h5 class="news-title">${news.title}</h5>
                    <p class="news-summary text-secondary">${news.summary}</p>
                    <div class="news-meta">
                        <span class="text-info">${news.source}</span>
                        <span class="text-muted">â€¢</span>
                        <span class="text-muted">${this.formatTime(news.timestamp)}</span>
                        <span class="text-muted">â€¢</span>
                        <span class="text-warning">æ¥­å‹™å½±éŸ¿: ${news.businessImpact}</span>
                    </div>
                    <div class="news-tags mt-2">
                        ${news.tags.map(tag => `<span class="news-tag">${tag}</span>`).join('')}
                    </div>
                    ${news.relevantClients.length > 0 ? `
                        <div class="mt-2">
                            <small class="text-success">
                                <i class="fas fa-user-tie me-1"></i>
                                ç›¸é—œå®¢æˆ¶: ${news.relevantClients.join(', ')}
                            </small>
                        </div>
                    ` : ''}
                </div>
                <div class="news-actions">
                    <button class="neon-btn btn-sm" onclick="previewNews(${news.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="neon-btn btn-sm green" onclick="shareNews(${news.id})">
                        <i class="fas fa-share"></i>
                    </button>
                    <button class="neon-btn btn-sm purple" onclick="saveNews(${news.id})">
                        <i class="fas fa-star"></i>
                    </button>
                </div>
            </div>
        `;
        
        return card;
    }
    
    bindEvents() {
        // æ‹–æ‹½äº‹ä»¶
        document.addEventListener('dragstart', (e) => {
            if (e.target.classList.contains('news-card')) {
                e.target.classList.add('dragging');
                e.dataTransfer.setData('text/plain', e.target.dataset.newsId);
            }
        });
        
        document.addEventListener('dragend', (e) => {
            if (e.target.classList.contains('news-card')) {
                e.target.classList.remove('dragging');
            }
        });
        
        // æ‹–æ‹½å€åŸŸ
        const dropZone = document.getElementById('shareDropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('active');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('active');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('active');
            const newsId = e.dataTransfer.getData('text/plain');
            this.shareNews(newsId);
        });
        
        // å®¢æˆ¶é¸æ“‡
        document.addEventListener('click', (e) => {
            if (e.target.closest('.client-item')) {
                const clientItem = e.target.closest('.client-item');
                document.querySelectorAll('.client-item').forEach(item => 
                    item.classList.remove('active'));
                clientItem.classList.add('active');
                this.currentClient = clientItem.dataset.clientId;
                this.updateNewsRelevance();
            }
        });
        
        // æ–°èæ‡¸åœé è¦½
        document.addEventListener('mouseover', (e) => {
            if (e.target.closest('.news-card')) {
                const newsId = e.target.closest('.news-card').dataset.newsId;
                this.showQuickPreview(newsId);
            }
        });
        
        // å…¨å±€æœç´¢
        document.getElementById('globalSearch').addEventListener('input', (e) => {
            this.filterNews(e.target.value);
        });
    }
    
    showQuickPreview(newsId) {
        const news = this.newsData.find(n => n.id == newsId);
        if (!news) return;
        
        const preview = document.getElementById('newsPreview');
        const content = document.getElementById('previewContent');
        
        content.innerHTML = `
            <h6>${news.title}</h6>
            <p class="small">${news.summary}</p>
            <div class="text-muted small">
                å„ªå…ˆç´š: ${news.priority} | æ¥­å‹™å½±éŸ¿: ${news.businessImpact}
            </div>
        `;
        
        preview.style.display = 'block';
        preview.dataset.newsId = newsId;
    }
    
    shareNews(newsId) {
        const news = this.newsData.find(n => n.id == newsId);
        if (!news) return;
        
        // é¡¯ç¤ºåˆ†äº«å°è©±æ¡†
        const modal = document.createElement('div');
        modal.className = 'modal fade show';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content bg-dark">
                    <div class="modal-header border-info">
                        <h5 class="modal-title text-info">åˆ†äº«æ–°è</h5>
                        <button type="button" class="btn-close btn-close-white" onclick="this.closest('.modal').remove()"></button>
                    </div>
                    <div class="modal-body">
                        <h6 class="text-white">${news.title}</h6>
                        <div class="mt-3">
                            <label class="form-label text-white">é¸æ“‡åˆ†äº«æ–¹å¼:</label>
                            <div class="d-grid gap-2">
                                <button class="neon-btn" onclick="shareViaLine(${newsId})">
                                    <i class="fab fa-line me-2"></i>LINEåˆ†äº«
                                </button>
                                <button class="neon-btn purple" onclick="shareViaEmail(${newsId})">
                                    <i class="fas fa-envelope me-2"></i>Emailåˆ†äº«
                                </button>
                                <button class="neon-btn green" onclick="shareViaPDF(${newsId})">
                                    <i class="fas fa-file-pdf me-2"></i>PDFåŒ¯å‡º
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
    }
    
    updateNewsRelevance() {
        // æ ¹æ“šé¸ä¸­çš„å®¢æˆ¶æ›´æ–°æ–°èç›¸é—œæ€§é¡¯ç¤º
        document.querySelectorAll('.news-card').forEach(card => {
            const newsId = card.dataset.newsId;
            const news = this.newsData.find(n => n.id == newsId);
            
            if (news && news.relevantClients.includes(this.getClientName(this.currentClient))) {
                card.style.borderLeft = '4px solid var(--neon-green)';
                card.style.background = 'rgba(57, 255, 20, 0.05)';
            } else {
                card.style.borderLeft = '';
                card.style.background = '';
            }
        });
    }
    
    getClientName(clientId) {
        const clientNames = {
            '1': 'å¼µç¾ç²',
            '2': 'æå¿—æ˜',
            '3': 'ç‹å°è¯'
        };
        return clientNames[clientId] || '';
    }
    
    filterNews(searchTerm) {
        const filteredNews = this.newsData.filter(news => 
            news.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
            news.summary.toLowerCase().includes(searchTerm.toLowerCase()) ||
            news.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))
        );
        
        document.querySelectorAll('.news-card').forEach(card => {
            const newsId = card.dataset.newsId;
            const isVisible = filteredNews.some(news => news.id == newsId);
            card.style.display = isVisible ? 'block' : 'none';
        });
    }
    
    formatTime(timestamp) {
        const now = new Date();
        const diff = now - timestamp;
        const hours = Math.floor(diff / (1000 * 60 * 60));
        
        if (hours < 1) return 'å‰›å‰›';
        if (hours < 24) return `${hours}å°æ™‚å‰`;
        return timestamp.toLocaleDateString();
    }
    
    startRealTimeUpdates() {
        // æ¨¡æ“¬å¯¦æ™‚æ›´æ–°
        setInterval(() => {
            this.checkForBusinessOpportunities();
        }, 30000); // æ¯30ç§’æª¢æŸ¥ä¸€æ¬¡
    }
    
    checkForBusinessOpportunities() {
        // éš¨æ©Ÿé¡¯ç¤ºæ¥­å‹™æ©Ÿæœƒæé†’
        if (Math.random() > 0.8) {
            const alert = document.getElementById('opportunityAlert');
            const text = document.getElementById('opportunityText');
            
            const opportunities = [
                'æª¢æ¸¬åˆ°é†«ç™‚éšªæ–°èï¼Œå»ºè­°è¯ç¹«é—œæ³¨å¥åº·ä¿éšœçš„å®¢æˆ¶',
                'é€€ä¼‘è¦åŠƒç›¸é—œæ–°èå¢åŠ ï¼Œé©åˆæ¨å»£å¹´é‡‘å•†å“',
                'æ•¸ä½ä¿éšªè©±é¡Œç†±åº¦ä¸Šå‡ï¼Œå¯å‘å¹´è¼•å®¢æˆ¶æ¨è–¦ç·šä¸ŠæŠ•ä¿'
            ];
            
            text.textContent = opportunities[Math.floor(Math.random() * opportunities.length)];
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 10000);
        }
    }
}

// å…¨å±€å‡½æ•¸
function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
}

function refreshData() {
    window.businessCenter.loadNews();
    window.cyberpunkSound.sounds.notification();
}

function previewNews(newsId) {
    window.businessCenter.showQuickPreview(newsId);
}

function shareNews(newsId) {
    window.businessCenter.shareNews(newsId);
}

function saveNews(newsId) {
    // å¯¦ç¾æ”¶è—åŠŸèƒ½
    console.log('æ”¶è—æ–°è:', newsId);
    window.cyberpunkSound.sounds.click();
}

function selectAll() {
    document.querySelectorAll('.news-checkbox').forEach(checkbox => {
        checkbox.checked = true;
    });
}

function shareSelected() {
    const selected = Array.from(document.querySelectorAll('.news-checkbox:checked'))
        .map(checkbox => checkbox.dataset.newsId);
    
    if (selected.length > 0) {
        alert(`å·²é¸æ“‡ ${selected.length} æ¢æ–°èé€²è¡Œåˆ†äº«`);
    }
}

function markImportant() {
    const selected = Array.from(document.querySelectorAll('.news-checkbox:checked'));
    selected.forEach(checkbox => {
        const card = checkbox.closest('.news-card');
        card.classList.add('news-priority-high');
    });
}

function exportPDF() {
    const selected = Array.from(document.querySelectorAll('.news-checkbox:checked'))
        .map(checkbox => checkbox.dataset.newsId);
    
    if (selected.length > 0) {
        alert(`æ­£åœ¨åŒ¯å‡º ${selected.length} æ¢æ–°èç‚ºPDF...`);
    }
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    window.businessCenter = new BusinessNewsCenter();
    
    // åˆå§‹åŒ–è³½åšæœ‹å…‹æ•ˆæœ
    console.log('ğŸ¤– å•Ÿå‹•è³½åšæœ‹å…‹è¦–è¦ºæ•ˆæœç³»çµ±...');
    
    // ç¢ºä¿è¼‰å…¥è³½åšæœ‹å…‹ç‰¹æ•ˆ
    if (typeof CyberpunkParticleSystem !== 'undefined') {
        window.cyberpunkParticles = new CyberpunkParticleSystem();
        console.log('âœ… è³½åšæœ‹å…‹ç²’å­ç³»çµ±å·²å•Ÿå‹•');
    } else {
        console.warn('âš ï¸ è³½åšæœ‹å…‹ç²’å­ç³»çµ±æœªè¼‰å…¥ï¼Œæ‰‹å‹•è¼‰å…¥...');
        // å‹•æ…‹è¼‰å…¥è³½åšæœ‹å…‹ç‰¹æ•ˆ
        const script = document.createElement('script');
        script.src = '/static/js/cyberpunk-effects.js';
        script.onload = () => {
            window.cyberpunkParticles = new CyberpunkParticleSystem();
            console.log('âœ… è³½åšæœ‹å…‹ç²’å­ç³»çµ±å·²å‹•æ…‹è¼‰å…¥ä¸¦å•Ÿå‹•');
        };
        document.head.appendChild(script);
    }
    
    // æ·»åŠ è³½åšæœ‹å…‹èƒŒæ™¯ç¶²æ ¼
    const body = document.body;
    if (!body.classList.contains('cyber-grid')) {
        body.classList.add('cyber-grid');
        console.log('âœ… è³½åšæœ‹å…‹ç¶²æ ¼èƒŒæ™¯å·²æ‡‰ç”¨');
    }
    
    // å‰µå»ºé¡å¤–çš„ç¶²æ ¼èƒŒæ™¯å…ƒç´ 
    if (!document.querySelector('.cyber-grid-overlay')) {
        const gridOverlay = document.createElement('div');
        gridOverlay.className = 'cyber-grid-overlay';
        gridOverlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.4) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.4) 1px, transparent 1px),
                linear-gradient(rgba(139, 95, 191, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 95, 191, 0.3) 1px, transparent 1px);
            background-size: 
                50px 50px,
                50px 50px,
                10px 10px,
                10px 10px;
            background-position:
                0 0,
                0 0,
                25px 25px,
                25px 25px;
            animation: gridPulse 3s ease-in-out infinite, gridShift 8s linear infinite;
            filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.3));
            pointer-events: none;
        `;
        document.body.appendChild(gridOverlay);
        console.log('âœ… å¼·åŒ–ç¶²æ ¼èƒŒæ™¯è¦†è“‹å±¤å·²æ·»åŠ ');
    }
    
    // æ·»åŠ ç»ç’ƒå½¢æ…‹æ•ˆæœåˆ°æ‰€æœ‰å¡ç‰‡
    const cards = document.querySelectorAll('.news-card, .client-card, .action-card');
    cards.forEach(card => {
        if (!card.classList.contains('glass-morphism')) {
            card.classList.add('glass-morphism');
        }
    });
    console.log(`âœ… ç»ç’ƒå½¢æ…‹æ•ˆæœå·²æ‡‰ç”¨åˆ° ${cards.length} å€‹å…ƒä»¶`);
    
    // æ·»åŠ éœ“è™¹ç™¼å…‰æ•ˆæœ
    const buttons = document.querySelectorAll('.btn, .nav-link, .action-button');
    buttons.forEach(btn => {
        if (!btn.classList.contains('neon-border')) {
            btn.classList.add('neon-border');
        }
    });
    console.log(`âœ… éœ“è™¹ç™¼å…‰æ•ˆæœå·²æ‡‰ç”¨åˆ° ${buttons.length} å€‹æŒ‰éˆ•`);
});
</script>

<!-- è³½åšæœ‹å…‹ç‰¹æ•ˆè…³æœ¬ -->
<script src="{{ url_for('static', filename='js/cyberpunk-effects.js') }}"></script>
{% endblock %}
