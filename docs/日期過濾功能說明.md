# 新聞日期過濾功能說明

## 功能概述

新聞日期過濾功能讓您可以設定爬蟲只抓取指定天數內的新聞，避免抓取過期的舊新聞。預設設定為**只抓取7天內的新聞**。

## 主要特點

- ✅ **預設7天限制**: 只抓取7天內發布的新聞
- ✅ **靈活配置**: 可設定1-365天的任意時間範圍
- ✅ **可完全停用**: 需要時可以停用日期過濾
- ✅ **智能解析**: 自動識別各種日期格式
- ✅ **API控制**: 可透過API動態調整設定
- ✅ **容錯處理**: 無法解析日期的新聞會被保留

## 快速開始

### 方法1: 使用配置工具（推薦）

```bash
# 執行配置工具
python configure_date_filter.py
```

配置工具提供互動式界面，讓您輕鬆設定：
- 最大新聞天數（1-365天）
- 是否啟用日期過濾
- 即時查看設定效果

### 方法2: 直接修改配置文件

編輯 `config/config.yaml`：

```yaml
crawler:
  # 其他爬蟲設定...
  max_news_age_days: 7        # 只抓取7天內的新聞
  enable_date_filter: true    # 啟用日期過濾
```

### 方法3: 透過API控制

```bash
# 查看目前設定
curl http://localhost:5000/api/crawler/date-filter

# 更新設定為只抓取3天內的新聞
curl -X POST http://localhost:5000/api/crawler/date-filter \
  -H "Content-Type: application/json" \
  -d '{"max_age_days": 3, "enable_filter": true}'

# 停用日期過濾
curl -X POST http://localhost:5000/api/crawler/date-filter \
  -H "Content-Type: application/json" \
  -d '{"enable_filter": false}'
```

## 使用場景建議

### 1天內新聞
```yaml
max_news_age_days: 1
```
- **適用**: 需要最即時新聞
- **優點**: 資料最新鮮
- **缺點**: 新聞數量可能較少

### 3天內新聞
```yaml
max_news_age_days: 3
```
- **適用**: 業務重點關注近期動態
- **優點**: 平衡時效性和數量
- **缺點**: 週末可能新聞較少

### 7天內新聞（預設）
```yaml
max_news_age_days: 7
```
- **適用**: 一般使用情況
- **優點**: 涵蓋一週完整資訊
- **推薦**: 大多數使用者的最佳選擇

### 14天內新聞
```yaml
max_news_age_days: 14
```
- **適用**: 需要較多背景資訊
- **優點**: 提供更完整的資訊脈絡
- **注意**: 可能包含已過時的資訊

### 30天內新聞
```yaml
max_news_age_days: 30
```
- **適用**: 月度分析和報告
- **優點**: 大量歷史數據
- **缺點**: 可能混雜過時資訊

### 停用過濾
```yaml
enable_date_filter: false
```
- **適用**: 需要所有歷史資料
- **注意**: 會抓取所有能找到的新聞
- **風險**: 可能重複抓取大量舊新聞

## 技術細節

### 日期識別機制

過濾器會按優先順序尋找這些日期欄位：
1. `published_date` - 發布日期
2. `publish_date` - 發布日期（替代格式）
3. `date` - 一般日期
4. `created_at` - 創建日期
5. `pubDate` - RSS格式發布日期

### 日期格式支援

支援多種日期格式：
- ISO 8601: `2024-07-09T10:30:00Z`
- 中文格式: `2024年7月9日`
- 美式格式: `07/09/2024`
- 歐式格式: `09/07/2024`
- RFC 2822: `Tue, 09 Jul 2024 10:30:00 GMT`

### 時區處理

- 自動識別時區資訊
- 無時區資訊的日期假設為UTC
- 所有比較均使用UTC時間

## 監控和除錯

### 查看過濾統計

啟動爬蟲後，日誌會顯示過濾統計：

```
INFO - 日期過濾完成: 原始 15 篇，保留 8 篇，移除 7 篇
```

### API狀態查詢

```bash
curl http://localhost:5000/api/crawler/status
```

回應包含日期過濾器狀態：
```json
{
  "status": "success",
  "data": {
    "date_filter": {
      "enabled": true,
      "max_age_days": 7,
      "cutoff_date": "2024-07-02T10:30:00Z",
      "cutoff_date_formatted": "2024-07-02 10:30:00 UTC"
    }
  }
}
```

### 測試功能

執行測試腳本驗證功能：

```bash
python test_date_filter.py
```

## 常見問題

### Q: 為什麼設定後沒有立即生效？
A: 設定變更會在下次爬蟲執行時生效。您可以手動觸發爬蟲或等待定時執行。

### Q: 無法解析日期的新聞會怎麼處理？
A: 為了避免遺漏重要新聞，無法解析日期的新聞會被保留而不會被過濾掉。

### Q: 停用過濾器會影響效能嗎？
A: 停用過濾器可能導致大量舊新聞被重複抓取，建議只在必要時停用。

### Q: 可以針對不同來源設定不同的天數限制嗎？
A: 目前版本是全域設定，未來版本會考慮增加按來源的個別設定功能。

### Q: 如何恢復預設設定？
A: 執行配置工具選擇預設選項，或將配置文件中的值改回：
```yaml
max_news_age_days: 7
enable_date_filter: true
```

## 更新記錄

- **v1.0.0** (2024-07-09)
  - 初始版本發布
  - 支援全域日期過濾
  - 提供配置工具和API接口
  - 預設7天限制

---

**注意**: 這個功能是為了確保您獲得最相關和最新的保險新聞資訊。如有任何問題或建議，請聯繫開發團隊。
